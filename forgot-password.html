<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بازیابی رمز عبور | PsyClinic</title>

    <!-- SEO Meta Tags -->
    <meta name="robots" content="noindex, nofollow" />
    <meta name="description" content="درخواست بازیابی رمز عبور حساب کاربری در کلینیک مجازی PsyClinic." />

    <!-- Bootstrap 5 RTL CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Main CSS -->
    <link href="assets/css/main.css" rel="stylesheet">
    <!-- AOS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Custom Styles -->
    <style>
        :root {
            --primary-color: #6c63ff;
            --secondary-color: #4cc9f0;
        }
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f5f7fb;
        }
        .reset-card {
            max-width: 450px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: none;
        }
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            border-radius: 10px;
            padding: 12px;
            font-weight: 600;
        }
        .form-control {
            border-radius: 10px;
            padding: 12px 15px;
        }
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .alert-box {
            display: none;
        }
    </style>
</head>
<body>

    <!-- HEADER (مینیمال برای تمرکز) -->
    <header class="bg-white shadow-sm">
        <nav class="navbar navbar-light">
            <div class="container justify-content-between">
                <a class="navbar-brand fw-bold" href="index.html">PsyClinic</a>
                <a href="login.html" class="btn btn-outline-primary btn-sm">ورود</a>
            </div>
        </nav>
    </header>

    <!-- MAIN CONTENT -->
    <section class="py-5">
        <div class="container">
            <div class="card reset-card" data-aos="fade-up">
                <div class="card-body">
                    <div class="text-center mb-4">
                        <i class="bi bi-lock-fill text-primary" style="font-size: 3rem;"></i>
                        <h4 class="mt-3">رمز عبور خود را بازیابی کنید</h4>
                        <p class="text-muted small">
                            ایمیل یا شماره موبایلی که با آن ثبت‌نام کرده‌اید را وارد کنید تا لینک بازیابی را دریافت کنید.
                        </p>
                    </div>

                    <!-- Alert Box for Success/Error Messages -->
                    <div id="statusAlert" class="alert-box mb-3"></div>

                    <form id="resetForm">
                        <!-- Honeypot Field (Security) -->
                        <div style="opacity: 0; position: absolute; left: -9999px;">
                            <input type="text" name="website" tabindex="-1" autocomplete="off">
                        </div>
                        
                        <div class="mb-4">
                            <label for="identifier" class="form-label">ایمیل یا شماره موبایل</label>
                            <input type="text" class="form-control" id="identifier" name="identifier" 
                                   placeholder="example@email.com یا 09xxxxxxxxx" required autocomplete="username">
                            <div class="invalid-feedback"></div>
                        </div>

                        <!-- CAPTCHA Placeholder (Security) -->
                        <div class="mb-4">
                             <!-- reCAPTCHA v3/hCaptcha implementation goes here -->
                             <div class="g-recaptcha" data-sitekey="YOUR_RECAPTCHA_SITE_KEY_V2_OR_V3"></div>
                             <small class="text-muted small d-block mt-2">
                                 این به ما کمک می‌کند تا شما را از ربات‌ها تشخیص دهیم.
                             </small>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 d-flex align-items-center justify-content-center">
                            <span class="loading-spinner"></span>
                            <span class="btn-text">ارسال لینک بازیابی</span>
                        </button>
                    </form>
                    
                    <div class="text-center mt-3 small">
                        <a href="login.html" class="text-primary fw-bold">بازگشت به صفحه ورود</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center">
            <p class="mb-0 small">&copy; ۱۴۰۴ PsyClinic</p>
            <div class="small mt-2">
                <a href="terms.html" class="text-white-50">قوانین</a> | 
                <a href="privacy.html" class="text-white-50">حریم خصوصی</a>
            </div>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- AOS -->
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>AOS.init({ once: true, duration: 800 });</script>
    <!-- reCAPTCHA API (must be loaded for CAPTCHA placeholder to work) -->
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <!-- Custom JS for Form Handling -->
    <script>
        // Regex patterns for validation
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        // Allows +98 or 09XX numbers
        const phonePattern = /^(\+98|0)?9\d{9}$/; 

        const form = document.getElementById('resetForm');
        const identifierInput = document.getElementById('identifier');
        const statusAlert = document.getElementById('statusAlert');
        const submitBtn = form.querySelector('button[type="submit"]');
        const spinner = form.querySelector('.loading-spinner');
        const btnText = form.querySelector('.btn-text');

        // Function to display alert messages
        function showAlert(message, type = 'danger') {
            statusAlert.className = `alert alert-${type} alert-box`;
            statusAlert.innerHTML = `<i class="bi bi-exclamation-triangle-fill me-2"></i> ${message}`;
            statusAlert.style.display = 'block';
        }
        
        // Function to validate the identifier field
        function validateIdentifier(identifier) {
            if (!identifier) {
                return "لطفاً ایمیل یا شماره موبایل خود را وارد کنید.";
            }
            if (emailPattern.test(identifier) || phonePattern.test(identifier)) {
                return null; // Valid
            }
            return "فرمت وارد شده صحیح نیست. از ایمیل یا شماره موبایل معتبر استفاده کنید.";
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const identifier = identifierInput.value.trim();
            const validationError = validateIdentifier(identifier);
            
            // 1. Client-Side Validation
            if (validationError) {
                identifierInput.classList.add('is-invalid');
                identifierInput.nextElementSibling.textContent = validationError;
                showAlert("خطا: " + validationError, 'danger');
                return;
            } else {
                identifierInput.classList.remove('is-invalid');
            }

            // 2. CAPTCHA Validation (If using v2 checkbox)
            const recaptchaResponse = grecaptcha.getResponse();
            if (document.querySelector('.g-recaptcha') && !recaptchaResponse) {
                 showAlert("لطفاً تأیید کنید که ربات نیستید.", 'warning');
                 return;
            }

            // Show Loading State
            spinner.style.display = 'inline-block';
            btnText.textContent = 'در حال ارسال...';
            submitBtn.disabled = true;
            statusAlert.style.display = 'none';

            // 3. Simulate API Call (POST /api/auth/forgot-password)
            setTimeout(() => {
                // Simulate success response
                const isUserFound = true; // In real life, check API response status

                if (isUserFound) {
                    showAlert('لینک بازیابی به ایمیل شما ارسال شد. لطفاً صندوق ورودی خود را بررسی کنید.', 'success');
                    // Reset form after successful submission
                    form.reset(); 
                } else {
                    // Important Security Note: DO NOT reveal if the email was found or not.
                    showAlert('اگر حساب کاربری مرتبطی یافت شود، لینک بازیابی ارسال خواهد شد.', 'success'); 
                }

                // Hide Loading State
                spinner.style.display = 'none';
                btnText.textContent = 'ارسال لینک بازیابی';
                submitBtn.disabled = false;
                grecaptcha.reset(); // Reset CAPTCHA if using v2
            }, 2500); 
        });
    </script>
</body>
</html>