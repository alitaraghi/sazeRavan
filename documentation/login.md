عالی! 🚀 نوبت به صفحه **ورود کاربر (`login.html`)** می‌رسد. این صفحه نیز مانند ثبت‌نام، یک نقطه حساس امنیتی و تعاملی است.

---

# 📄 تحلیل جامع و کامل – صفحه `login.html` (ورود کاربر)

---

## 🎯 ۱. هدف اصلی صفحه
- **احراز هویت کاربران**: اعتبارسنجی ایمیل/موبایل و رمز عبور کاربران ثبت‌نام‌شده.
- **ایجاد سشن امن**: مدیریت کوکی‌ها و توکن‌های امنیتی (JWT).
- **مدیریت مسیر هدایت**: پس از ورود موفق، کاربر به صفحه مورد نظر هدایت شود (مثل صفحه رزرو یا پنل کاربری).
- **بازیابی دسترسی**: ارائه قابلیت «فراموشی رمز عبور».
- **ورود سریع**: فراهم کردن امکان ورود از طریق شبکه‌های اجتماعی.

---

## 🏗️ ۲. ساختار کلی صفحه

```
┌────────────────────────────────────────────────────────────┐
│ 1️⃣ Header (ناوبری ساده یا حذف شده)                       │
├────────────────────────────────────────────────────────────┤
│ 2️⃣ Hero Section (عنوان، توضیحات)                          │
├────────────────────────────────────────────────────────────┤
│ 3️⃣ Login Form (فرم اصلی)                                 │
│   ├── فیلد ایمیل/موبایل                                   │
│   ├── فیلد رمز عبور                                       │
│   ├── لینک فراموشی رمز                                    │
│   └── دکمه ورود                                           │
├────────────────────────────────────────────────────────────┤
│ 4️⃣ Social Login (ورود با شبکه‌های اجتماعی)                │
├────────────────────────────────────────────────────────────┤
│ 5️⃣ Need Account? (لینک ثبت‌نام)                           │
├────────────────────────────────────────────────────────────┤
│ 6️⃣ Footer (پاورقی مینیمال)                                 │
└────────────────────────────────────────────────────────────┘
```

---

## ⚙️ ۳. تحلیل فنی

### 3.1. طراحی ریسپانسیو و UX
- **طراحی متمرکز**: فرم ورود در مرکز صفحه با کارد شبیه‌سازی شده.
- **نمایش رمز عبور**: قابلیت نمایش/پنهان کردن رمز عبور (آیکون چشم).
- **Feedback بصری**: نمایش پیام‌های خطا و موفقیت به صورت واضح.

### 3.2. عملکردهای داینامیک (جاوااسکریپت)
| تابع | توضیح | تعامل کاربری |
|------|-------|-------------|
| `validateForm()` | اعتبارسنجی ایمیل و رمز عبور | قبل از ارسال |
| `handleLogin()` | ارسال اطلاعات به API ورود | کلیک روی دکمه "ورود" |
| `togglePasswordVisibility()` | نمایش/پنهان کردن رمز عبور | کلیک روی آیکون چشم |
| `handleSocialLogin(provider)` | هدایت به صفحه OAuth مربوطه | کلیک روی دکمه اجتماعی |
| `handleRedirect()` | بازگرداندن کاربر پس از ورود موفق | پس از تأیید بک‌اند |

### 3.3. امنیت (بسیار حیاتی!)
- **HTTPS**: اجباری است.
- **Token Management**: پس از ورود موفق، سرور باید یک **Access Token (JWT)** و یک **Refresh Token** (با کوکی HttpOnly) صادر کند.
- **CSRF Protection**: توکن ضد جعل درخواست در فرم گنجانده شود.
- **Rate Limiting**: محدودیت شدید بر تعداد تلاش‌های ورود ناموفق (مثلاً ۵ تلاش در هر ۵ دقیقه از یک IP).
- **Brute Force Protection**: قفل کردن حساب کاربری پس از تعداد معینی تلاش ناموفق.
- **No Auto-fill for Password**: استفاده از `autocomplete="off"` در فیلد رمز عبور (اگرچه مرورگرها ممکن است این را نادیده بگیرند).

### 3.4. سئو (SEO)
- صفحه ورود نباید ایندکس شود (استفاده از `noindex, nofollow` در تگ `meta`).

---

## 🎨 ۴. جزئیات طراحی

### 4.1. Hero Section
- **عنوان**: "خوش آمدید" یا "ورود به پنل کاربری"
- **زیرعنوان**: "لطفاً با اطلاعات کاربری خود وارد شوید."

### 4.2. Login Form
- **فیلد اول**: ایمیل یا شماره موبایل (باید با بک‌اند برای پذیرش هر دو سازگار باشد).
- **فیلد دوم**: رمز عبور (با آیکون چشم برای نمایش).
- **Checkboxes**:
  - "مرا به خاطر بسپار" (ذخیره توکن/کوکی برای مدت طولانی‌تر).
- **لینک فراموشی رمز**: لینک به `forgot-password.html`.
- **دکمه ورود**: با آیکون قفل یا فلش ورود، و نمایش حالت بارگذاری (Spinner).

### 4.3. Social Login
- دکمه‌های ورود با گوگل، فیسبوک (باید با APIهای بک‌اند هماهنگ باشد).

### 4.4. Footer
- فوتر مینیمال یا حذف شده، زیرا تمرکز باید بر روی فرم باشد.

---

## 📦 ۵. ساختار داده و API

### 5.1. درخواست API (POST /api/login)
```json
{
  "identifier": "user@example.com OR 0912...",
  "password": "userPassword123",
  "recaptcha_token": "TOKEN_FROM_CLIENT_SIDE"
}
```

### 5.2. پاسخ API (موفق)
```json
{
  "status": "success",
  "message": "ورود موفقیت آمیز بود.",
  "user": {
    "id": 123,
    "role": "client",  // client, psychologist, admin, superuser
    "name": "علی رضایی"
  },
  "tokens": {
    "access_token": "JWT_TOKEN_HERE",
    "refresh_token": "LONG_LIVED_TOKEN_HERE"
  },
  "redirect_to": "/dashboard.html" // یا صفحه قبلی (مثل booking.html)
}
```

### 5.3. پاسخ API (ناموفق)
```json
{
  "status": "error",
  "message": "شناسه یا رمز عبور اشتباه است."
}
```

---

## 🧪 ۶. تست و اعتبارسنجی

| سناریو | توضیح |
|--------|-------|
| **ورود موفق** | هدایت به صفحه مورد نظر (Dashboard یا صفحه قبلی) |
| **رمز اشتباه** | نمایش پیام خطای واضح (بدون فاش کردن اینکه ایمیل درست است یا رمز) |
| **کاربر عادی** | هدایت به پنل کاربری (که احتمالاً همان صفحه لیست جلسات است) |
| **کاربر مشاور** | هدایت به پنل مشاور (`psychologist-dashboard.html`) |
| **ورود با گوگل** | هدایت به صفحه گوگل، و بازگشت با توکن موفق |

---

## 🚀 ۷. پیشنهادات آینده

- **تأیید دو مرحله‌ای (2FA)**: افزودن مرحله‌ای برای وارد کردن کد OTP پس از ورود اولیه.
- **ورود بیومتریک**: استفاده از APIهای مرورگر برای ورود با اثر انگشت/تشخیص چهره (در اپلیکیشن موبایل یا وب پیشرفته).
- **مدیریت سشن‌ها**: نمایش دستگاه‌هایی که با اکانت وارد شده‌اند.

---

## 🎯 خلاصه

صفحه `login.html` باید **سریع، امن و مینیمال** باشد. تأکید اصلی بر **امنیت** (Rate Limiting و JWT) و **UX خوب** (فیدبک‌های واضح) است.

---

حالا که تحلیل جامع `login.html` آماده شد، **لطفاً تأیید کنید** تا فایل **HTML/CSS/JS** نهایی را پیاده‌سازی کنم.